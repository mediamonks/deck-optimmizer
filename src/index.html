<!DOCTYPE html>
<html>

<head>
    <title>Deck Optimmizer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;900&display=swap" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
</head>

<body>

    <div class="footer">deck optimmizer beta v0.2 <a target="_blank"
            href="https://github.com/mirkovw/deck-optimmizer">source</a></div>
    <div class="main">

        <div class="title"> deck optimmizer <sup class="beta">beta</sup> </div>
        <div class="helpTxt">
            First, share the deck with<br>
            deck-optimmizer@deck-optimmizer.iam.gserviceaccount.com<br><br>

            Then, enter the URL in the field below and hit 'Optimize'.
        </div>

        <form class='form' id="form" action="">
            <input id="input" autocomplete="off" />
            <button class="optimize">Optimize</button>
        </form>

        <ul id="messages">
        </ul>

        <form id="optimizeChoice">
            <input type="radio" name="optimizeChoice" value="auto" onclick=DisplayAuto()>
            <label>Auto-Optimize</label>
            <input type="radio" name="optimizeChoice" value="manual" onclick=DisplayManual()>
            <label>Optimize Manually</label>
        </form>

        <br>
        <div id="optimizePanel">
            <ul id="sourceGifs">
            </ul>
            <ul id="controls">
            </ul>
            <ul id="outputGifs">
            </ul>
        </div>


    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();

        var messages = document.getElementById('messages');
        var form = document.getElementById('form');
        var optimizeChoice = document.getElementById('optimizeChoice');
        var input = document.getElementById('input');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (input.value) {
                document.querySelector('#form').remove();
                document.querySelector('.helpTxt').innerHTML = 'Would you like to run an auto optimization or choose tune each gif manually?';
                //document.querySelector('#messages').style.display='block';

                document.querySelector('#optimizeChoice').style.display = 'block';

                socket.emit('presentationId', input.value);
                input.value = '';
            }
        });

        function DisplayManual() {
            document.querySelector('#optimizePanel').style.display = 'block';
            document.querySelector('#sourceGifs').style.display = 'block';
            document.querySelector('#controls').style.display = 'block';
            document.querySelector('#outputGifs').style.display = 'block';
        };

        // TODO: fix source gifs do not display
        socket.on('DisplayGif', function (msg) {
            var targetArea = document.getElementById(msg.target);
            var item = document.createElement('li');
            var gif = document.createElement('img');

            gif.src = msg.path;
            item.appendChild(gif);
            targetArea.appendChild(item);
        });

        // TODO: fix this function - not getting triggered?
        socket.on('Expand'), function () {
            var targetArea = document.getElementById("controls");
            var item = document.createElement('li');
            item.id = 'spacer';
            targetArea.appendChild(item);
        };

        socket.on('update message', function (msg) {
            var item = document.createElement('li');
            item.innerHTML = msg.data;
            //messages.appendChild(item);
            messages.insertBefore(item, messages.firstChild);

            window.scrollTo(0, document.body.scrollHeight);
            console.log(msg.data)
        });
    </script>
</body>

</html>