<!DOCTYPE html>
<html>

<head>
    <title>Deck Optimmizer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;900&display=swap" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
</head>

<body>

    <div class="footer">deck optimmizer beta v0.2 <a target="_blank"
            href="https://github.com/mirkovw/deck-optimmizer">source</a></div>
    <div class="main">

        <div class="title"> deck optimmizer <sup class="beta">beta</sup> </div>
        <div class="helpTxt">
            First, share the deck with<br>
            deck-optimmizer@deck-optimmizer.iam.gserviceaccount.com<br><br>

            Then, enter the URL in the field below and hit 'Optimize'.
        </div>

        <form class='form' id="form" action="">
            <input id="input" autocomplete="off" />
            <button class="optimize">Optimize</button>
        </form>

        <ul id="messages">
        </ul>

        <form id="optimizeChoice">
            <input type="radio" name="optimizeChoice" value="auto" onclick=DisplayAuto()>
            <label for="auto">Auto-Optimize</label>
            <input type="radio" name="optimizeChoice" value="manual" onclick=DisplayManual()>
            <label for="manual">Optimize Manually</label>
        </form>

        <br>
        <div id="optimizePanel">
            <ul>
                <li>Original</li>
                <li></li>
                <li>Preview</li>
        </div>

        <div id="optionsContainer">
            <form id="optionsForm" action="">
                <label for="compressions">Compression type:</label>
                <select name="compressions" id="compressionDD">
                    <option value="lossy">Lossy</option>
                </select><br>
                
                <label for="factor">Compression Factor:</label>
                <label for="factor" id="displayFactor"></label>
                <input type="range" min="0" max="250" value="30" class="slider" id="factor"><br>

                <label for="">Apply colour correction?</label>
                <input type="checkbox" value="applyColourCorrect"><br>

                <label for="">Colour range:</label>
                <label for="range" id="displayRange"></label>
                <input type="range" min="2" max="256" value="30" class="slider" id="colourRange"><br>

                <label for="">Adjust frame rate?</label>
                <input type="checkbox" value="adjustFrameRate"><br>

                <label for="frameRate" id="displayframeRate"></label>
                <input type="range" min="2" max="256" value="30" class="slider" id="frameRate"><br>

                <button type="button" onclick="">Apply</button>

            </form>
        </div>

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();

        var messages = document.getElementById('messages');
        var form = document.getElementById('form');
        var optimizeChoice = document.getElementById('optimizeChoice');
        var input = document.getElementById('input');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (input.value) {
                document.querySelector('#form').remove();
                document.querySelector('.helpTxt').innerHTML = 'Would you like to run an auto optimization or choose tune each gif manually?';
                //document.querySelector('#messages').style.display='block';

                document.querySelector('#optimizeChoice').style.display = 'block';

                socket.emit('presentationId', input.value);
                input.value = '';
            }
        });

        // TODO: Display only 1 preview source/output gif
        function DisplayAuto() {
            document.querySelector('#optimizePanel').style.display = 'block';
            document.querySelector('#optionsContainer').style.display = 'block';
        };

        function DisplayManual() {
            document.querySelector('#optimizePanel').style.display = 'block';
            document.querySelector('#optionsContainer').style.display = 'none';
        }

        socket.on('DisplayGif', function (msg) {
            var targetArea = document.getElementById('optimizePanel');
            var ul = document.createElement('ul');
            var li = document.createElement('li');
            var gif = document.createElement('img');

            // Source gif
            ul.appendChild(li);
            gif.src = msg.source;
            li.appendChild(gif);

            // Options
            ul.appendChild(document.createElement('li'));

            // Output gif
            li = document.createElement('li');
            gif = document.createElement('img');
            ul.appendChild(li);
            gif.src = msg.output;
            li.appendChild(gif);

            targetArea.appendChild(ul);
        });

        socket.on('update message', function (msg) {
            var item = document.createElement('li');
            item.innerHTML = msg.data;
            //messages.appendChild(item);
            messages.insertBefore(item, messages.firstChild);

            //window.scrollTo(0, document.body.scrollHeight);
            console.log(msg.data)
        });
    </script>
</body>

</html>